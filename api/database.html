
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>4.2. Email Database &#8212; Alot User Manual</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4.3. User Interface" href="interface.html" />
    <link rel="prev" title="4.1. Overview" href="overview.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="interface.html" title="4.3. User Interface"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="4.1. Overview"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Alot User Manual</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">4. API and Development</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="module-alot.db">
<span id="email-database"></span><h1>4.2. Email Database<a class="headerlink" href="#module-alot.db" title="Permalink to this headline">¶</a></h1>
<p>The python bindings to libnotmuch define <code class="xref py py-class docutils literal notranslate"><span class="pre">notmuch.Thread</span></code> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">notmuch.Message</span></code>, which unfortunately are very fragile.
Alot defines the wrapper classes <a class="reference internal" href="#alot.db.Thread" title="alot.db.Thread"><code class="xref py py-class docutils literal notranslate"><span class="pre">alot.db.Thread</span></code></a> and <a class="reference internal" href="#alot.db.Message" title="alot.db.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">alot.db.Message</span></code></a> that
use an <a class="reference internal" href="#alot.db.manager.DBManager" title="alot.db.manager.DBManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">manager.DBManager</span></code></a> instance to transparently provide persistent objects.</p>
<p><a class="reference internal" href="#alot.db.Message" title="alot.db.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">alot.db.Message</span></code></a> moreover contains convenience methods
to extract information about the message like reformated header values, a summary,
decoded and interpreted body text and a list of <a class="reference internal" href="#alot.db.attachment.Attachment" title="alot.db.attachment.Attachment"><code class="xref py py-class docutils literal notranslate"><span class="pre">Attachments</span></code></a>.</p>
<p>The central <a class="reference internal" href="interface.html#alot.ui.UI" title="alot.ui.UI"><code class="xref py py-class docutils literal notranslate"><span class="pre">UI</span></code></a> instance carries around a <a class="reference internal" href="#alot.db.manager.DBManager" title="alot.db.manager.DBManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">DBManager</span></code></a> object that
is used for any lookups or modifications of the email base. <a class="reference internal" href="#alot.db.manager.DBManager" title="alot.db.manager.DBManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">DBManager</span></code></a> can
directly look up <a class="reference internal" href="#alot.db.Thread" title="alot.db.Thread"><code class="xref py py-class docutils literal notranslate"><span class="pre">Thread</span></code></a> and <a class="reference internal" href="#alot.db.Message" title="alot.db.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code></a> objects and is able to
postpone/cache/retry writing operations in case the Xapian index is locked by another
process.</p>
<div class="section" id="database-manager">
<h2>4.2.1. Database Manager<a class="headerlink" href="#database-manager" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="alot.db.manager.DBManager">
<em class="property">class </em><code class="descclassname">alot.db.manager.</code><code class="descname">DBManager</code><span class="sig-paren">(</span><em>path=None</em>, <em>ro=False</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Keeps track of your index parameters, maintains a write-queue and
lets you look up threads and messages directly to the persistent wrapper
classes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – absolute path to the notmuch index</li>
<li><strong>ro</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – open the index in read-only mode</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="alot.db.manager.DBManager.add_message">
<code class="descname">add_message</code><span class="sig-paren">(</span><em>path</em>, <em>tags=None</em>, <em>afterwards=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.add_message" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a file to the notmuch index.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>path</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – path to the file</li>
<li><strong>tags</strong> (<em>list of str</em>) – tagstrings to add</li>
<li><strong>afterwards</strong> (<em>callable</em><em> or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)"><em>None</em></a>) – callback to trigger after adding</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.async_">
<code class="descname">async_</code><span class="sig-paren">(</span><em>cbl</em>, <em>fun</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.async_" title="Permalink to this definition">¶</a></dt>
<dd><p>return a pair (pipe, process) so that the process writes
<cite>fun(a)</cite> to the pipe for each element <cite>a</cite> in the iterable returned
by the callable <cite>cbl</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cbl</strong> (<em>callable</em>) – a function returning something iterable</li>
<li><strong>fun</strong> (<em>callable</em>) – an unary translation function</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(<code class="xref py py-class docutils literal notranslate"><span class="pre">multiprocessing.Pipe</span></code>,
<a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Process" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">multiprocessing.Process</span></code></a>)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.count_messages">
<code class="descname">count_messages</code><span class="sig-paren">(</span><em>querystring</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.count_messages" title="Permalink to this definition">¶</a></dt>
<dd><p>returns number of messages that match <cite>querystring</cite></p>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.count_threads">
<code class="descname">count_threads</code><span class="sig-paren">(</span><em>querystring</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.count_threads" title="Permalink to this definition">¶</a></dt>
<dd><p>returns number of threads that match <cite>querystring</cite></p>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.flush">
<code class="descname">flush</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.flush" title="Permalink to this definition">¶</a></dt>
<dd><p>write out all queued write-commands in order, each one in a separate
<code class="xref py py-meth docutils literal notranslate"><span class="pre">atomic</span></code> transaction.</p>
<p>If this fails the current action is rolled back, stays in the write
queue and an exception is raised.
You are responsible to retry flushing at a later time if you want to
ensure that the cached changes are applied to the database.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Exception:</th><td class="field-body"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DatabaseROError</span></code> if db is opened read-only</td>
</tr>
<tr class="field-even field"><th class="field-name">Exception:</th><td class="field-body"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DatabaseLockedError</span></code> if db is locked</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.get_all_tags">
<code class="descname">get_all_tags</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.get_all_tags" title="Permalink to this definition">¶</a></dt>
<dd><p>returns all tagsstrings used in the database
:rtype: list of str</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.get_message">
<code class="descname">get_message</code><span class="sig-paren">(</span><em>mid</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.get_message" title="Permalink to this definition">¶</a></dt>
<dd><p>returns <code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code> with given message id (str)</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.get_named_queries">
<code class="descname">get_named_queries</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.get_named_queries" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the named queries stored in the database.
:rtype: dict (str -&gt; str) mapping alias to full query string</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.get_thread">
<code class="descname">get_thread</code><span class="sig-paren">(</span><em>tid</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.get_thread" title="Permalink to this definition">¶</a></dt>
<dd><p>returns <code class="xref py py-class docutils literal notranslate"><span class="pre">Thread</span></code> with given thread id (str)</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.get_threads">
<code class="descname">get_threads</code><span class="sig-paren">(</span><em>querystring</em>, <em>sort='newest_first'</em>, <em>exclude_tags=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.get_threads" title="Permalink to this definition">¶</a></dt>
<dd><p>asynchronously look up thread ids matching <cite>querystring</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>querystring</strong> (<em>str.</em>) – The query string to use for the lookup</li>
<li><strong>sort</strong> – Sort order. one of [‘oldest_first’, ‘newest_first’,
‘message_id’, ‘unsorted’]</li>
<li><strong>exclude_tags</strong> (<em>list of str</em>) – Tags to exclude by default unless included in the
search</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">a pipe together with the process that asynchronously
writes to it.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">(<code class="xref py py-class docutils literal notranslate"><span class="pre">multiprocessing.Pipe</span></code>,
<a class="reference external" href="https://docs.python.org/3/library/multiprocessing.html#multiprocessing.Process" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">multiprocessing.Process</span></code></a>)</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.kill_search_processes">
<code class="descname">kill_search_processes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.kill_search_processes" title="Permalink to this definition">¶</a></dt>
<dd><p>terminate all search processes that originate from
this managers <a class="reference internal" href="#alot.db.manager.DBManager.get_threads" title="alot.db.manager.DBManager.get_threads"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_threads()</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.query">
<code class="descname">query</code><span class="sig-paren">(</span><em>querystring</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.query" title="Permalink to this definition">¶</a></dt>
<dd><p>creates <code class="xref py py-class docutils literal notranslate"><span class="pre">notmuch.Query</span></code> objects on demand</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>querystring</strong> – The query string to use for the lookup</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><code class="xref py py-class docutils literal notranslate"><span class="pre">notmuch.Query</span></code> – the query object.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.remove_message">
<code class="descname">remove_message</code><span class="sig-paren">(</span><em>message</em>, <em>afterwards=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.remove_message" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a message from the notmuch index</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>message</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code>) – message to remove</li>
<li><strong>afterwards</strong> (<em>callable</em><em> or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)"><em>None</em></a>) – callback to trigger after removing</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.remove_named_query">
<code class="descname">remove_named_query</code><span class="sig-paren">(</span><em>alias</em>, <em>afterwards=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.remove_named_query" title="Permalink to this definition">¶</a></dt>
<dd><p>remove a named query from the notmuch database.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>alias</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – name of shortcut</li>
<li><strong>afterwards</strong> (<em>callable</em><em> or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)"><em>None</em></a>) – callback to trigger after adding the alias</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.save_named_query">
<code class="descname">save_named_query</code><span class="sig-paren">(</span><em>alias</em>, <em>querystring</em>, <em>afterwards=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.save_named_query" title="Permalink to this definition">¶</a></dt>
<dd><p>add an alias for a query string.</p>
<p>These are stored in the notmuch database and can be used as part of
more complex queries using the syntax “query:alias”.
See <em class="manpage">notmuch-search-terms(7)</em> for more info.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>alias</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – name of shortcut</li>
<li><strong>querystring</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – value, i.e., the full query string</li>
<li><strong>afterwards</strong> (<em>callable</em><em> or </em><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.7)"><em>None</em></a>) – callback to trigger after adding the alias</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.tag">
<code class="descname">tag</code><span class="sig-paren">(</span><em>querystring</em>, <em>tags</em>, <em>afterwards=None</em>, <em>remove_rest=False</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.tag" title="Permalink to this definition">¶</a></dt>
<dd><p>add tags to messages matching <cite>querystring</cite>.
This appends a tag operation to the write queue and raises
<code class="xref py py-exc docutils literal notranslate"><span class="pre">DatabaseROError</span></code> if in read only mode.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>querystring</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – notmuch search string</li>
<li><strong>tags</strong> (<em>list of str</em>) – a list of tags to be added</li>
<li><strong>afterwards</strong> (<em>callable</em>) – callback that gets called after successful
application of this tagging operation</li>
<li><strong>remove_rest</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – remove tags from matching messages before tagging</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Exception:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DatabaseROError</span></code></p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This only adds the requested operation to the write queue.
You need to call <a class="reference internal" href="#alot.db.manager.DBManager.flush" title="alot.db.manager.DBManager.flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DBManager.flush()</span></code></a> to actually write out.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="alot.db.manager.DBManager.untag">
<code class="descname">untag</code><span class="sig-paren">(</span><em>querystring</em>, <em>tags</em>, <em>afterwards=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.manager.DBManager.untag" title="Permalink to this definition">¶</a></dt>
<dd><p>removes tags from messages that match <cite>querystring</cite>.
This appends an untag operation to the write queue and raises
<code class="xref py py-exc docutils literal notranslate"><span class="pre">DatabaseROError</span></code> if in read only mode.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>querystring</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – notmuch search string</li>
<li><strong>tags</strong> (<em>list of str</em>) – a list of tags to be added</li>
<li><strong>afterwards</strong> (<em>callable</em>) – callback that gets called after successful
application of this tagging operation</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Exception:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DatabaseROError</span></code></p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This only adds the requested operation to the write queue.
You need to call <a class="reference internal" href="#alot.db.manager.DBManager.flush" title="alot.db.manager.DBManager.flush"><code class="xref py py-meth docutils literal notranslate"><span class="pre">DBManager.flush()</span></code></a> to actually write out.</p>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-alot.db.errors">
<span id="errors"></span><h2>4.2.2. Errors<a class="headerlink" href="#module-alot.db.errors" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="alot.db.errors.DatabaseError">
<em class="property">class </em><code class="descclassname">alot.db.errors.</code><code class="descname">DatabaseError</code><a class="headerlink" href="#alot.db.errors.DatabaseError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="alot.db.errors.DatabaseROError">
<em class="property">class </em><code class="descclassname">alot.db.errors.</code><code class="descname">DatabaseROError</code><a class="headerlink" href="#alot.db.errors.DatabaseROError" title="Permalink to this definition">¶</a></dt>
<dd><p>cannot write to read-only database</p>
</dd></dl>

<dl class="class">
<dt id="alot.db.errors.DatabaseLockedError">
<em class="property">class </em><code class="descclassname">alot.db.errors.</code><code class="descname">DatabaseLockedError</code><a class="headerlink" href="#alot.db.errors.DatabaseLockedError" title="Permalink to this definition">¶</a></dt>
<dd><p>cannot write to locked index</p>
</dd></dl>

<dl class="class">
<dt id="alot.db.errors.NonexistantObjectError">
<em class="property">class </em><code class="descclassname">alot.db.errors.</code><code class="descname">NonexistantObjectError</code><a class="headerlink" href="#alot.db.errors.NonexistantObjectError" title="Permalink to this definition">¶</a></dt>
<dd><p>requested thread or message does not exist in the index</p>
</dd></dl>

</div>
<div class="section" id="wrapper">
<h2>4.2.3. Wrapper<a class="headerlink" href="#wrapper" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="alot.db.Thread">
<em class="property">class </em><code class="descclassname">alot.db.</code><code class="descname">Thread</code><span class="sig-paren">(</span><em>dbman</em>, <em>thread</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread" title="Permalink to this definition">¶</a></dt>
<dd><p>A wrapper around a notmuch mailthread (<code class="xref py py-class docutils literal notranslate"><span class="pre">notmuch.database.Thread</span></code>)
that ensures persistence of the thread: It can be safely read multiple
times, its manipulation is done via a <code class="xref py py-class docutils literal notranslate"><span class="pre">alot.db.DBManager</span></code> and it can
directly provide contained messages as <code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dbman</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">DBManager</span></code>) – db manager that is used for further lookups</li>
<li><strong>thread</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">notmuch.database.Thread</span></code>) – the wrapped thread</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="alot.db.Thread.add_tags">
<code class="descname">add_tags</code><span class="sig-paren">(</span><em>tags</em>, <em>afterwards=None</em>, <em>remove_rest=False</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.add_tags" title="Permalink to this definition">¶</a></dt>
<dd><p>add <cite>tags</cite> to all messages in this thread</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This only adds the requested operation to this objects
<code class="xref py py-class docutils literal notranslate"><span class="pre">DBManager's</span></code> write queue.
You need to call <code class="xref py py-meth docutils literal notranslate"><span class="pre">DBManager.flush</span></code>
to actually write out.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>tags</strong> (<em>list of str</em>) – a list of tags to be added</li>
<li><strong>afterwards</strong> (<em>callable</em>) – callback that gets called after successful
application of this tagging operation</li>
<li><strong>remove_rest</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – remove all other tags</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.get_authors">
<code class="descname">get_authors</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.get_authors" title="Permalink to this definition">¶</a></dt>
<dd><p>returns a list of authors (name, addr) of the messages.
The authors are ordered by msg date and unique (by name/addr).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">list of (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a>)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.get_authors_string">
<code class="descname">get_authors_string</code><span class="sig-paren">(</span><em>own_addrs=None</em>, <em>replace_own=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.get_authors_string" title="Permalink to this definition">¶</a></dt>
<dd><p>returns a string of comma-separated authors
Depending on settings, it will substitute “me” for author name if
address is user’s own.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>own_addrs</strong> (<em>list of str</em>) – list of own email addresses to replace</li>
<li><strong>replace_own</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – whether or not to actually do replacement</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.get_messages">
<code class="descname">get_messages</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.get_messages" title="Permalink to this definition">¶</a></dt>
<dd><p>returns all messages in this thread as dict mapping all contained
messages to their direct responses.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">dict mapping <code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code> to a list of
<code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code>.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.get_newest_date">
<code class="descname">get_newest_date</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.get_newest_date" title="Permalink to this definition">¶</a></dt>
<dd><p>returns date header of newest message in this thread as
<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.get_oldest_date">
<code class="descname">get_oldest_date</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.get_oldest_date" title="Permalink to this definition">¶</a></dt>
<dd><p>returns date header of oldest message in this thread as
<a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.get_replies_to">
<code class="descname">get_replies_to</code><span class="sig-paren">(</span><em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.get_replies_to" title="Permalink to this definition">¶</a></dt>
<dd><p>returns all replies to the given message contained in this thread.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>msg</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code>) – parent message to look up</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of <code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code> or <cite>None</cite></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.get_subject">
<code class="descname">get_subject</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.get_subject" title="Permalink to this definition">¶</a></dt>
<dd><p>returns subject string</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.get_tags">
<code class="descname">get_tags</code><span class="sig-paren">(</span><em>intersection=False</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.get_tags" title="Permalink to this definition">¶</a></dt>
<dd><p>returns tagsstrings attached to this thread</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>intersection</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – return tags present in all contained messages
instead of in at least one (union)</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">set of str</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.get_thread_id">
<code class="descname">get_thread_id</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.get_thread_id" title="Permalink to this definition">¶</a></dt>
<dd><p>returns id of this thread</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.get_toplevel_messages">
<code class="descname">get_toplevel_messages</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.get_toplevel_messages" title="Permalink to this definition">¶</a></dt>
<dd><p>returns all toplevel messages contained in this thread.
This are all the messages without a parent message
(identified by ‘in-reply-to’ or ‘references’ header.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">list of <code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.get_total_messages">
<code class="descname">get_total_messages</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.get_total_messages" title="Permalink to this definition">¶</a></dt>
<dd><p>returns number of contained messages</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.matches">
<code class="descname">matches</code><span class="sig-paren">(</span><em>query</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.matches" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if this thread matches the given notmuch query.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>query</strong> (<em>string</em>) – The query to check against</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">True if this thread matches the given query, False otherwise</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)">bool</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.refresh">
<code class="descname">refresh</code><span class="sig-paren">(</span><em>thread=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.refresh" title="Permalink to this definition">¶</a></dt>
<dd><p>refresh thread metadata from the index</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Thread.remove_tags">
<code class="descname">remove_tags</code><span class="sig-paren">(</span><em>tags</em>, <em>afterwards=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Thread.remove_tags" title="Permalink to this definition">¶</a></dt>
<dd><p>remove <cite>tags</cite> (list of str) from all messages in this thread</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This only adds the requested operation to this objects
<code class="xref py py-class docutils literal notranslate"><span class="pre">DBManager's</span></code> write queue.
You need to call <code class="xref py py-meth docutils literal notranslate"><span class="pre">DBManager.flush</span></code>
to actually write out.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>tags</strong> (<em>list of str</em>) – a list of tags to be added</li>
<li><strong>afterwards</strong> (<em>callable</em>) – callback that gets called after successful
application of this tagging operation</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="alot.db.Message">
<em class="property">class </em><code class="descclassname">alot.db.</code><code class="descname">Message</code><span class="sig-paren">(</span><em>dbman</em>, <em>msg</em>, <em>thread=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message" title="Permalink to this definition">¶</a></dt>
<dd><p>a persistent notmuch message object.
It it uses a <code class="xref py py-class docutils literal notranslate"><span class="pre">DBManager</span></code> for cached manipulation
and lazy lookups.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>dbman</strong> (<em>alot.db.DBManager</em>) – db manager that is used for further lookups</li>
<li><strong>msg</strong> (<em>notmuch.database.Message</em>) – the wrapped message</li>
<li><strong>thread</strong> (<a class="reference internal" href="#alot.db.Thread" title="alot.db.Thread"><code class="xref py py-class docutils literal notranslate"><span class="pre">Thread</span></code></a> or <cite>None</cite>) – this messages thread (will be looked up later if <cite>None</cite>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="alot.db.Message.accumulate_body">
<code class="descname">accumulate_body</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.accumulate_body" title="Permalink to this definition">¶</a></dt>
<dd><p>returns bodystring extracted from this mail</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.add_tags">
<code class="descname">add_tags</code><span class="sig-paren">(</span><em>tags</em>, <em>afterwards=None</em>, <em>remove_rest=False</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.add_tags" title="Permalink to this definition">¶</a></dt>
<dd><p>adds tags to message</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This only adds the requested operation to this objects
<code class="xref py py-class docutils literal notranslate"><span class="pre">DBManager's</span></code> write queue.
You need to call <code class="xref py py-meth docutils literal notranslate"><span class="pre">flush()</span></code> to write out.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>tags</strong> (<em>list of str</em>) – a list of tags to be added</li>
<li><strong>afterwards</strong> (<em>callable</em>) – callback that gets called after successful
application of this tagging operation</li>
<li><strong>remove_rest</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – remove all other tags</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.get_attachments">
<code class="descname">get_attachments</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.get_attachments" title="Permalink to this definition">¶</a></dt>
<dd><p>returns messages attachments</p>
<p>Derived from the leaves of the email mime tree
that and are not part of <span class="target" id="index-0"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2015.html"><strong>RFC 2015</strong></a> syntax for encrypted/signed mails
and either have <em class="mailheader">Content-Disposition</em> <cite>attachment</cite>
or have <em class="mailheader">Content-Disposition</em> <cite>inline</cite> but specify
a filename (as parameter to <cite>Content-Disposition</cite>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">list of <code class="xref py py-class docutils literal notranslate"><span class="pre">Attachment</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.get_author">
<code class="descname">get_author</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.get_author" title="Permalink to this definition">¶</a></dt>
<dd><p>returns realname and address of this messages author</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">(<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a>,<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a>)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.get_date">
<code class="descname">get_date</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.get_date" title="Permalink to this definition">¶</a></dt>
<dd><p>returns Date header value as <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.get_datestring">
<code class="descname">get_datestring</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.get_datestring" title="Permalink to this definition">¶</a></dt>
<dd><p>returns reformated datestring for this message.</p>
<p>It uses <code class="xref py py-meth docutils literal notranslate"><span class="pre">SettingsManager.represent_datetime()</span></code> to represent
this messages <cite>Date</cite> header</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.get_email">
<code class="descname">get_email</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.get_email" title="Permalink to this definition">¶</a></dt>
<dd><p>returns <code class="xref py py-class docutils literal notranslate"><span class="pre">email.Message</span></code> for this message</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.get_filename">
<code class="descname">get_filename</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.get_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>returns absolute path of message files location</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.get_message_id">
<code class="descname">get_message_id</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.get_message_id" title="Permalink to this definition">¶</a></dt>
<dd><p>returns messages id (str)</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.get_message_parts">
<code class="descname">get_message_parts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.get_message_parts" title="Permalink to this definition">¶</a></dt>
<dd><p>yield all body parts of this message</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.get_replies">
<code class="descname">get_replies</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.get_replies" title="Permalink to this definition">¶</a></dt>
<dd><p>returns replies to this message as list of <a class="reference internal" href="#alot.db.Message" title="alot.db.Message"><code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code></a></p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.get_tags">
<code class="descname">get_tags</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.get_tags" title="Permalink to this definition">¶</a></dt>
<dd><p>returns tags attached to this message as list of strings</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.get_thread">
<code class="descname">get_thread</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.get_thread" title="Permalink to this definition">¶</a></dt>
<dd><p>returns the <a class="reference internal" href="#alot.db.Thread" title="alot.db.Thread"><code class="xref py py-class docutils literal notranslate"><span class="pre">Thread</span></code></a> this msg belongs to</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.get_thread_id">
<code class="descname">get_thread_id</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.get_thread_id" title="Permalink to this definition">¶</a></dt>
<dd><p>returns id (str) of the thread this message belongs to</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.has_replies">
<code class="descname">has_replies</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.has_replies" title="Permalink to this definition">¶</a></dt>
<dd><p>returns true if this message has at least one reply</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.matches">
<code class="descname">matches</code><span class="sig-paren">(</span><em>querystring</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.matches" title="Permalink to this definition">¶</a></dt>
<dd><p>tests if this messages is in the resultset for <cite>querystring</cite></p>
</dd></dl>

<dl class="method">
<dt id="alot.db.Message.remove_tags">
<code class="descname">remove_tags</code><span class="sig-paren">(</span><em>tags</em>, <em>afterwards=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.Message.remove_tags" title="Permalink to this definition">¶</a></dt>
<dd><p>remove tags from message</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This only adds the requested operation to this objects
<code class="xref py py-class docutils literal notranslate"><span class="pre">DBManager's</span></code> write queue.
You need to call <code class="xref py py-meth docutils literal notranslate"><span class="pre">flush()</span></code> to actually out.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>tags</strong> (<em>list of str</em>) – a list of tags to be added</li>
<li><strong>afterwards</strong> (<em>callable</em>) – callback that gets called after successful
application of this tagging operation</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="other-structures">
<h2>4.2.4. Other Structures<a class="headerlink" href="#other-structures" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="alot.db.attachment.Attachment">
<em class="property">class </em><code class="descclassname">alot.db.attachment.</code><code class="descname">Attachment</code><span class="sig-paren">(</span><em>emailpart</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.attachment.Attachment" title="Permalink to this definition">¶</a></dt>
<dd><p>represents a mail attachment</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>emailpart</strong> (<a class="reference external" href="https://docs.python.org/3/library/email.compat32-message.html#email.message.Message" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">email.message.Message</span></code></a>) – a non-multipart email that is the attachment</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="alot.db.attachment.Attachment.get_content_type">
<code class="descname">get_content_type</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.attachment.Attachment.get_content_type" title="Permalink to this definition">¶</a></dt>
<dd><p>mime type of the attachment part</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.attachment.Attachment.get_data">
<code class="descname">get_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.attachment.Attachment.get_data" title="Permalink to this definition">¶</a></dt>
<dd><p>return data blob from wrapped file</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.attachment.Attachment.get_filename">
<code class="descname">get_filename</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.attachment.Attachment.get_filename" title="Permalink to this definition">¶</a></dt>
<dd><p>return name of attached file.
If the content-disposition header contains no file name,
this returns <cite>None</cite></p>
</dd></dl>

<dl class="method">
<dt id="alot.db.attachment.Attachment.get_mime_representation">
<code class="descname">get_mime_representation</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.attachment.Attachment.get_mime_representation" title="Permalink to this definition">¶</a></dt>
<dd><p>returns mime part that constitutes this attachment</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.attachment.Attachment.get_size">
<code class="descname">get_size</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.attachment.Attachment.get_size" title="Permalink to this definition">¶</a></dt>
<dd><p>returns attachments size in bytes</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.attachment.Attachment.save">
<code class="descname">save</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.attachment.Attachment.save" title="Permalink to this definition">¶</a></dt>
<dd><p>save the attachment to disk. Uses <a class="reference internal" href="#alot.db.attachment.Attachment.get_filename" title="alot.db.attachment.Attachment.get_filename"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_filename()</span></code></a> in case path
is a directory</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.attachment.Attachment.write">
<code class="descname">write</code><span class="sig-paren">(</span><em>fhandle</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.attachment.Attachment.write" title="Permalink to this definition">¶</a></dt>
<dd><p>writes content to a given filehandle</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="alot.db.envelope.Envelope">
<em class="property">class </em><code class="descclassname">alot.db.envelope.</code><code class="descname">Envelope</code><span class="sig-paren">(</span><em>template=None</em>, <em>bodytext=None</em>, <em>headers=None</em>, <em>attachments=None</em>, <em>sign=False</em>, <em>sign_key=None</em>, <em>encrypt=False</em>, <em>tags=None</em>, <em>replied=None</em>, <em>passed=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.envelope.Envelope" title="Permalink to this definition">¶</a></dt>
<dd><p>a message that is not yet sent and still editable.
It holds references to unencoded! body text and mail headers among other
things.  Envelope implements the python container API for easy access of
header values.  So <cite>e[‘To’]</cite>, <cite>e[‘To’] = ‘foo&#64;bar.baz’</cite> and
‘e.get_all(‘To’)’ would work for an envelope <cite>e</cite>..</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>template</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – if not None, the envelope will be initialised by
<a class="reference internal" href="#alot.db.envelope.Envelope.parse_template" title="alot.db.envelope.Envelope.parse_template"><code class="xref py py-meth docutils literal notranslate"><span class="pre">parsing</span></code></a> this string before
setting any other values given to this constructor.</li>
<li><strong>bodytext</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – text used as body part</li>
<li><strong>headers</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a><em> (</em><em>str -&gt;</em><em> [</em><em>unicode</em><em>]</em><em>)</em>) – unencoded header values</li>
<li><strong>attachments</strong> (list of <a class="reference internal" href="#alot.db.attachment.Attachment" title="alot.db.attachment.Attachment"><code class="xref py py-class docutils literal notranslate"><span class="pre">Attachment</span></code></a>) – file attachments to include</li>
<li><strong>tags</strong> (<em>list of str</em>) – tags to add after successful sendout and saving this msg</li>
<li><strong>replied</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Message</span></code>) – message being replied to</li>
<li><strong>passed</strong> – message being passed on</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="alot.db.envelope.Envelope.add">
<code class="descname">add</code><span class="sig-paren">(</span><em>key</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.envelope.Envelope.add" title="Permalink to this definition">¶</a></dt>
<dd><p>add header value</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.envelope.Envelope.attach">
<code class="descname">attach</code><span class="sig-paren">(</span><em>attachment</em>, <em>filename=None</em>, <em>ctype=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.envelope.Envelope.attach" title="Permalink to this definition">¶</a></dt>
<dd><p>attach a file</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>attachment</strong> (<a class="reference internal" href="#alot.db.attachment.Attachment" title="alot.db.attachment.Attachment"><code class="xref py py-class docutils literal notranslate"><span class="pre">Attachment</span></code></a> or str) – File to attach, given as
<a class="reference internal" href="#alot.db.attachment.Attachment" title="alot.db.attachment.Attachment"><code class="xref py py-class docutils literal notranslate"><span class="pre">Attachment</span></code></a> object or path to a file.</li>
<li><strong>filename</strong> – filename to use in content-disposition.
Will be ignored if <cite>path</cite> matches multiple files</li>
<li><strong>ctype</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – force content-type to be used for this attachment</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="alot.db.envelope.Envelope.construct_mail">
<code class="descname">construct_mail</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.envelope.Envelope.construct_mail" title="Permalink to this definition">¶</a></dt>
<dd><p>compiles the information contained in this envelope into a
<code class="xref py py-class docutils literal notranslate"><span class="pre">email.Message</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.envelope.Envelope.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>key</em>, <em>fallback=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.envelope.Envelope.get" title="Permalink to this definition">¶</a></dt>
<dd><p>secure getter for header values that allows specifying a <cite>fallback</cite>
return string (defaults to None). This returns the first matching value
and doesn’t raise KeyErrors</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.envelope.Envelope.get_all">
<code class="descname">get_all</code><span class="sig-paren">(</span><em>key</em>, <em>fallback=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.envelope.Envelope.get_all" title="Permalink to this definition">¶</a></dt>
<dd><p>returns all header values for given key</p>
</dd></dl>

<dl class="method">
<dt id="alot.db.envelope.Envelope.parse_template">
<code class="descname">parse_template</code><span class="sig-paren">(</span><em>tmp</em>, <em>reset=False</em>, <em>only_body=False</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.envelope.Envelope.parse_template" title="Permalink to this definition">¶</a></dt>
<dd><p>parses a template or user edited string to fills this envelope.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>tmp</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – the string to parse.</li>
<li><strong>reset</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – remove previous envelope content</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="alot.db.envelope.Envelope.attachments">
<code class="descname">attachments</code><em class="property"> = None</em><a class="headerlink" href="#alot.db.envelope.Envelope.attachments" title="Permalink to this definition">¶</a></dt>
<dd><p>list of <a class="reference internal" href="#alot.db.attachment.Attachment" title="alot.db.attachment.Attachment"><code class="xref py py-class docutils literal notranslate"><span class="pre">Attachments</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="alot.db.envelope.Envelope.body">
<code class="descname">body</code><em class="property"> = None</em><a class="headerlink" href="#alot.db.envelope.Envelope.body" title="Permalink to this definition">¶</a></dt>
<dd><p>mail body as unicode string</p>
</dd></dl>

<dl class="attribute">
<dt id="alot.db.envelope.Envelope.headers">
<code class="descname">headers</code><em class="property"> = None</em><a class="headerlink" href="#alot.db.envelope.Envelope.headers" title="Permalink to this definition">¶</a></dt>
<dd><p>dict containing the mail headers (a list of strings for each header key)</p>
</dd></dl>

<dl class="attribute">
<dt id="alot.db.envelope.Envelope.tags">
<code class="descname">tags</code><em class="property"> = []</em><a class="headerlink" href="#alot.db.envelope.Envelope.tags" title="Permalink to this definition">¶</a></dt>
<dd><p>tags to add after successful sendout</p>
</dd></dl>

<dl class="attribute">
<dt id="alot.db.envelope.Envelope.tmpfile">
<code class="descname">tmpfile</code><em class="property"> = None</em><a class="headerlink" href="#alot.db.envelope.Envelope.tmpfile" title="Permalink to this definition">¶</a></dt>
<dd><p>template text for initial content</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-alot.db.utils">
<span id="utilities"></span><h2>4.2.5. Utilities<a class="headerlink" href="#module-alot.db.utils" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="alot.db.utils.add_signature_headers">
<code class="descclassname">alot.db.utils.</code><code class="descname">add_signature_headers</code><span class="sig-paren">(</span><em>mail</em>, <em>sigs</em>, <em>error_msg</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.utils.add_signature_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>Add pseudo headers to the mail indicating whether the signature
verification was successful.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>mail</strong> – <a class="reference external" href="https://docs.python.org/3/library/email.compat32-message.html#email.message.Message" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">email.message.Message</span></code></a> the message to entitle</li>
<li><strong>sigs</strong> – list of <code class="xref py py-class docutils literal notranslate"><span class="pre">gpg.results.Signature</span></code></li>
<li><strong>error_msg</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a> or <cite>None</cite>) – An error message if there is one, or None</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.db.utils.decode_header">
<code class="descclassname">alot.db.utils.</code><code class="descname">decode_header</code><span class="sig-paren">(</span><em>header</em>, <em>normalize=False</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.utils.decode_header" title="Permalink to this definition">¶</a></dt>
<dd><p>decode a header value to a unicode string</p>
<p>values are usually a mixture of different substrings
encoded in quoted printable using different encodings.
This turns it into a single unicode string</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>header</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – the header value</li>
<li><strong>normalize</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – replace trailing spaces after newlines</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.db.utils.decrypted_message_from_bytes">
<code class="descclassname">alot.db.utils.</code><code class="descname">decrypted_message_from_bytes</code><span class="sig-paren">(</span><em>bytestring</em>, <em>session_keys=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.utils.decrypted_message_from_bytes" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a Message from bytes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>bytestring</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)"><em>bytes</em></a>) – an email message as raw bytes</li>
<li><strong>session_keys</strong> – a list OpenPGP session keys</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.db.utils.decrypted_message_from_file">
<code class="descclassname">alot.db.utils.</code><code class="descname">decrypted_message_from_file</code><span class="sig-paren">(</span><em>handle</em>, <em>session_keys=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.utils.decrypted_message_from_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads a mail from the given file-like object and returns an email
object, very much like email.message_from_file. In addition to
that OpenPGP encrypted data is detected and decrypted. If this
succeeds, any mime messages found in the recovered plaintext
message are added to the returned message object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>handle</strong> – a file-like object</li>
<li><strong>session_keys</strong> – a list OpenPGP session keys</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/email.compat32-message.html#email.message.Message" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">email.message.Message</span></code></a> possibly augmented with
decrypted data</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.db.utils.decrypted_message_from_message">
<code class="descclassname">alot.db.utils.</code><code class="descname">decrypted_message_from_message</code><span class="sig-paren">(</span><em>m</em>, <em>session_keys=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.utils.decrypted_message_from_message" title="Permalink to this definition">¶</a></dt>
<dd><p>Detect and decrypt OpenPGP encrypted data in an email object. If this
succeeds, any mime messages found in the recovered plaintext
message are added to the returned message object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>m</strong> – an email object</li>
<li><strong>session_keys</strong> – a list OpenPGP session keys</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/email.compat32-message.html#email.message.Message" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">email.message.Message</span></code></a> possibly augmented with
decrypted data</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.db.utils.decrypted_message_from_string">
<code class="descclassname">alot.db.utils.</code><code class="descname">decrypted_message_from_string</code><span class="sig-paren">(</span><em>s</em>, <em>session_keys=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.utils.decrypted_message_from_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads a mail from the given string. This is the equivalent of
<a class="reference external" href="https://docs.python.org/3/library/email.parser.html#email.message_from_string" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">email.message_from_string()</span></code></a> which does nothing but to wrap
the given string in a StringIO object and to call
<a class="reference external" href="https://docs.python.org/3/library/email.parser.html#email.message_from_file" title="(in Python v3.7)"><code class="xref py py-func docutils literal notranslate"><span class="pre">email.message_from_file()</span></code></a>.</p>
<p>Please refer to the documentation of <code class="xref py py-func docutils literal notranslate"><span class="pre">message_from_file()</span></code> for
details.</p>
</dd></dl>

<dl class="function">
<dt id="alot.db.utils.extract_body">
<code class="descclassname">alot.db.utils.</code><code class="descname">extract_body</code><span class="sig-paren">(</span><em>mail</em>, <em>types=None</em>, <em>field_key='copiousoutput'</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.utils.extract_body" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a string view of a Message.</p>
<p>If the <cite>types</cite> argument is set then any encoding types there will be used
as the prefered encoding to extract. If <cite>types</cite> is None then
<a class="reference internal" href="../configuration/config_options.html#prefer-plaintext"><span class="std std-ref">prefer_plaintext</span></a> will be consulted; if it is True
then text/plain parts will be returned, if it is false then text/html will
be returned if present or text/plain if there are no text/html parts.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>mail</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">email.Message</span></code>) – the mail to use</li>
<li><strong>types</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a><em>[</em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a><em>]</em>) – mime content types to use for body string</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The combined text of any parts to be used</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.db.utils.extract_headers">
<code class="descclassname">alot.db.utils.</code><code class="descname">extract_headers</code><span class="sig-paren">(</span><em>mail</em>, <em>headers=None</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.utils.extract_headers" title="Permalink to this definition">¶</a></dt>
<dd><p>returns subset of this messages headers as human-readable format:
all header values are decoded, the resulting string has
one line “KEY: VALUE” for each requested header present in the mail.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>mail</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">email.Message</span></code>) – the mail to use</li>
<li><strong>headers</strong> (<em>list of str</em>) – headers to extract</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.db.utils.get_params">
<code class="descclassname">alot.db.utils.</code><code class="descname">get_params</code><span class="sig-paren">(</span><em>mail</em>, <em>failobj=None</em>, <em>header='content-type'</em>, <em>unquote=True</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.utils.get_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Get Content-Type parameters as dict.</p>
<p>RFC 2045 specifies that parameter names are case-insensitive, so
we normalize them here.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>mail</strong> – <a class="reference external" href="https://docs.python.org/3/library/email.compat32-message.html#email.message.Message" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">email.message.Message</span></code></a></li>
<li><strong>failobj</strong> – object to return if no such header is found</li>
<li><strong>header</strong> – the header to search for parameters, default</li>
<li><strong>unquote</strong> – unquote the values</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a <cite>dict</cite> containing the parameters</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.db.utils.remove_cte">
<code class="descclassname">alot.db.utils.</code><code class="descname">remove_cte</code><span class="sig-paren">(</span><em>part</em>, <em>as_string=False</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.utils.remove_cte" title="Permalink to this definition">¶</a></dt>
<dd><p>Decodes any Content-Transfer-Encodings.</p>
<p>Can return a string for display, or bytes to be passed to an external
program.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>part</strong> (<em>email.Message</em>) – The part to decode</li>
<li><strong>as_string</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – If true return a str, otherwise return bytes</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">The mail with any Content-Transfer-Encoding removed</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">Union[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#bytes" title="(in Python v3.7)">bytes</a>]</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="alot.db.utils.render_part">
<code class="descclassname">alot.db.utils.</code><code class="descname">render_part</code><span class="sig-paren">(</span><em>part</em>, <em>field_key='copiousoutput'</em><span class="sig-paren">)</span><a class="headerlink" href="#alot.db.utils.render_part" title="Permalink to this definition">¶</a></dt>
<dd><p>renders a non-multipart email part into displayable plaintext by piping its
payload through an external script. The handler itself is determined by
the mailcap entry for this part’s ctype.</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4.2. Email Database</a><ul>
<li><a class="reference internal" href="#database-manager">4.2.1. Database Manager</a></li>
<li><a class="reference internal" href="#module-alot.db.errors">4.2.2. Errors</a></li>
<li><a class="reference internal" href="#wrapper">4.2.3. Wrapper</a></li>
<li><a class="reference internal" href="#other-structures">4.2.4. Other Structures</a></li>
<li><a class="reference internal" href="#module-alot.db.utils">4.2.5. Utilities</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="overview.html"
                        title="previous chapter">4.1. Overview</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="interface.html"
                        title="next chapter">4.3. User Interface</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/api/database.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="interface.html" title="4.3. User Interface"
             >next</a> |</li>
        <li class="right" >
          <a href="overview.html" title="4.1. Overview"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Alot User Manual</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >4. API and Development</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, Patrick Totzke.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.
    </div>
  </body>
</html>